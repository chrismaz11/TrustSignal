generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite" // "postgresql" for prod
  url      = env("DATABASE_URL")
}

model Receipt {
  id               String        @id @default(uuid())
  receiptHash      String
  inputsCommitment String
  policyProfile    String
  parcelId         String?
  decision         String
  reasons          String
  riskScore        Int
  checks           String
  rawInputs        String
  createdAt        DateTime      @default(now())
  anchorStatus     String        @default("PENDING")
  anchorTxHash     String?
  anchorChainId    String?
  anchorId         String?
  fraudRisk        String? // JSON
  zkpAttestation   String? // JSON
  revoked          Boolean       @default(false)
  deleted          Boolean       @default(false)
  deletedAt        DateTime?
  organizationId   String?
  organization     Organization? @relation(fields: [organizationId], references: [id])
  Revocation       Revocation[]
}

model Revocation {
  id             String       @id @default(uuid())
  receiptId      String
  receipt        Receipt      @relation(fields: [receiptId], references: [id])
  organizationId String
  organization   Organization @relation(fields: [organizationId], references: [id])
  reason         String
  revokedAt      DateTime     @default(now())
  revokedBy      String
}

model VerificationEvent {
  id             String        @id @default(uuid())
  timestamp      DateTime      @default(now())
  endpoint       String
  result         String
  ip             String?
  userAgent      String?
  receiptId      String?
  organizationId String?
  organization   Organization? @relation(fields: [organizationId], references: [id])
}

model Property {
  parcelId     String    @id
  currentOwner String
  lastSaleDate DateTime?
  updatedAt    DateTime  @updatedAt
}

model CountyRecord {
  parcelId String  @id
  county   String
  state    String
  active   Boolean @default(true)
}

model Notary {
  id              String @id
  name            String
  status          String
  commissionState String
}

model RequestLog {
  id             String        @id @default(uuid())
  endpoint       String
  method         String
  timestamp      DateTime      @default(now())
  ip             String?
  userAgent      String?
  receiptId      String?
  status         Int
  organizationId String?
  organization   Organization? @relation(fields: [organizationId], references: [id])
}

model Organization {
  id                String              @id @default(uuid())
  name              String
  adminEmail        String
  apiKey            String              @unique
  apiKeySecondary   String?             @unique
  rateLimit         Int?
  createdAt         DateTime            @default(now())
  retentionDays     Int? // Nullable means use default 90 days.
  Receipt           Receipt[]
  Revocation        Revocation[]
  VerificationEvent VerificationEvent[]
  RequestLogs       RequestLog[]
}
